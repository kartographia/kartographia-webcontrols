if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.Map=function(k,x){this.className="com.kartographia.Map";var A=this;var t;var n={basemap:new ol.layer.Tile({source:new ol.source.OSM()}),layers:[],center:[25,20],zoom:3,style:{info:{background:"rgba(255, 255, 255, 0.5)",fontFamily:'"MS Sans Serif",tahoma,arial,helvetica,sans-serif',fontSize:"8pt",color:"rgba(0,0,0,0.85)",cursor:"default"},coord:{padding:"0 3px 0 0",margin:"0 0 0 -5px",overflowX:"hidden",width:"100px",textAlign:"right"}}};var y;var s=new ol.format.WKT();var p=new ol.source.Vector();var m=new ol.layer.Vector({source:new ol.source.Vector({})});var a;var B;var v,l,q,u;var b=[];var o=-1;var i=false;var r=function(){if(typeof k==="string"){k=document.getElementById(k)}if(!k){return}var H={};g(H,x);var G=H.basemap;if(G){delete H.basemap}g(H,n);x=H;if(G){x.basemap=G}var E=document.createElement("div");E.style.position="relative";E.style.height="100%";E.setAttribute("desc",A.className);k.appendChild(E);A.el=E;v=document.createElement("div");d(v,x.style.info);v.style.position="absolute";v.style.left=0;v.style.bottom=0;v.style.zIndex=1;E.appendChild(v);l=document.createElement("div");d(l,x.style.info);l.style.position="absolute";l.style.right=0;l.style.bottom=0;l.style.zIndex=1;E.appendChild(l);q=document.createElement("div");d(q,x.style.coord);q.style.display="inline-block";l.appendChild(q);u=q.cloneNode();l.appendChild(u);y=new ol.Map({controls:ol.control.defaults({attribution:false}),interactions:ol.interaction.defaults({doubleClickZoom:false}),target:E,view:new ol.View({center:ol.proj.transform(x.center,"EPSG:4326","EPSG:3857"),zoom:x.zoom,maxZoom:19})});w(x.basemap);if(x.layers){for(var F=0;F<x.layers.length;F++){w(x.layers[F])}}w(m);w(new ol.layer.Vector({source:p}));var K=new ol.style.Fill({color:[180,0,0,1]});var L=new ol.style.Stroke({color:[180,0,0,1],width:1});var C=new ol.style.Style({image:new ol.style.Circle({fill:K,stroke:L,radius:3}),fill:K,stroke:L});m.setStyle(C);a=new ol.Overlay.Popup();y.addOverlay(a);B=new ol.interaction.DragBox({condition:ol.events.condition.always,style:new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,255,1]})})});B.setActive(false);B.on("boxstart",function(M){p.clear(true)});B.on("boxend",function(M){var N=M.target.getGeometry();var O=new ol.Feature({geometry:N.clone()});p.addFeature(O);N=N.clone().transform("EPSG:3857","EPSG:4326");var P=s.writeGeometry(N);A.onBoxSelect(P,N.getCoordinates())});y.addInteraction(B);y.on("moveend",function(){if(i===false){if(o<b.length-1){for(var M=b.length-1;M>o;M--){b.pop()}}b.push({extent:y.getView().calculateExtent(y.getSize()),navStep:y.getSize(),zoom:y.getView().getZoom()});o=o+1}A.onExtentChange()});y.on("pointermove",function(M){var N=ol.proj.transform(M.coordinate,"EPSG:3857","EPSG:4326");c(N[1],N[0]);A.onMouseMove(N[1],N[0])});y.on("singleclick",function(M){var N=ol.proj.transform(M.coordinate,"EPSG:3857","EPSG:4326");A.onMouseClick(N[1],N[0])});t=y.getViewport();var I=t.offsetWidth;if(I===0||isNaN(I)){var D;var J=function(){var M=t.offsetWidth;if(M===0||isNaN(M)){D=setTimeout(J,100)}else{clearTimeout(D);f()}};D=setTimeout(J,100)}else{f()}};var f=function(){A.resize();j(k,A.resize)};this.getCanvas=function(){for(var D=0;D<t.childNodes.length;D++){var E=t.childNodes[D];var C=E.tagName.toLowerCase();if(C=="canvas"){return E}}};this.back=function(){if(o>0){i=true;y.getView().fit(b[o-1].extent,b[o-1].navStep);y.getView().setZoom(b[o-1].zoom);setTimeout(function(){i=false},360);o=o-1}};this.next=function(){if(o<b.length-1){i=true;y.getView().fit(b[o+1].extent,b[o+1].navStep);y.getView().setZoom(b[o+1].zoom);setTimeout(function(){i=false},360);o=o+1}};this.getMap=function(){return y};this.getCoordinateDiv=function(){return l};this.updateSize=function(){A.resize()};this.resize=function(){y.updateSize()};this.getZoomLevel=function(){return y.getView().getZoom()};this.getResolution=function(){return y.getView().getResolution()};this.getProjection=function(){return y.getView().getProjection().getCode()};this.getExtent=function(){var C=y.getView();var E=C.calculateExtent(y.getSize());var D=ol.geom.Polygon.fromExtent(E);return s.writeGeometry(D.clone().transform("EPSG:3857","EPSG:4326"))};this.setExtent=function(E,F){var C=y.getView();if(typeof(E)==="string"||E instanceof String){var D=s.readFeature(E);E=D.getGeometry();E.transform("EPSG:4326","EPSG:3857")}else{if(E instanceof ol.geom.Geometry){}else{}}C.fit(E,y.getSize());if(F!=null){F.call()}};this.setCenter=function(C,E,D){y.getView().setCenter(ol.proj.transform([E,C],"EPSG:4326","EPSG:3857"));if(D){y.getView().setZoom(D)}};this.onExtentChange=function(){};this.onLoad=function(C){};this.onMouseMove=function(C,D){};this.onMouseClick=function(C,D){};this.onSelect=function(){};this.onBoxSelect=function(C,D){};this.panTo=function(D,E,G){var C=y.getView();if(E!=null){var F=ol.animation.pan({duration:E,source:C.getCenter()});y.beforeRender(F)}A.setExtent(D,G)};this.popup=function(E,D){if(typeof(E)==="string"||E instanceof String){var C=s.readFeature(E);E=C.getGeometry();E.transform("EPSG:4326","EPSG:3857");E=E.getCoordinates()}a.show(E,D)};this.hidePopup=function(){a.hide()};this.enableBoxSelect=function(){if(arguments.length===1&&arguments[0]===false){B.setActive(false)}else{B.setActive(true)}};this.clearBoxSelect=function(){p.clear(true)};this.addLayer=function(D,C){var E=y.getLayers().getLength();if(C==null){C=E-2}else{if(C>E-2){C=C-2}}return w(D,C)};var w=function(D,C){if(D==null){return}if(C!=null){y.getLayers().insertAt(C,D)}else{y.addLayer(D)}var E=D.getSource();if(E instanceof ol.source.Vector){D.addFeature=function(F){try{this.getSource().addFeature(z(F))}catch(G){console.log(G)}};D.clear=function(){this.getSource().clear(true)};D.getExtent=function(){return this.getSource().getExtent()}}else{D.clear=function(){};D.getExtent=function(){}}D.show=function(){this.setVisible(true)};D.hide=function(){this.setVisible(false)};D.isVisible=function(){return this.getVisible()};if(D instanceof ol.layer.Tile){D.on("precompose",function(G){v.innerHTML="Loading...";var F=h(this.getSource());if(F!=this.numTiles){this.numTiles=F;this.numTilesLoaded=0}});D.on("postcompose",function(F){if(this.numTilesLoaded){this.numTilesLoaded+=1}else{this.numTilesLoaded=1}if(this.numTilesLoaded>=this.numTiles){this.numTiles=0;this.numTilesLoaded=0;A.onLoad(this);setTimeout(function(){v.innerHTML=""},1500)}});D.refresh=function(){var F=this.getSource();F.tileCache.expireCache({});F.tileCache.clear();F.refresh()}}return D};this.addFeature=function(C){m.addFeature(z(C))};var z=function(E){if(E instanceof ol.Feature){return E}else{var C;if(E!=null){if(E.geom){C=e(E.geom)}else{if(E.geometry){C=e(E.geometry)}else{C=e(E)}}}var D=new ol.Feature({});if(C){D.setGeometry(C)}return D}};var e=function(D){if(typeof D==="string"||D instanceof String){var C=s.readFeature(D);D=C.getGeometry();D.transform("EPSG:4326","EPSG:3857");return D}else{if(D instanceof ol.geom.Geometry){return D}else{return null}}};this.clearFeatures=function(){m.getSource().clear()};var h=function(G){var E=(G.getTileGrid())?G.getTileGrid():ol.tilegrid.getForProjection(y.getView().getProjection()),F=E.getZForResolution(y.getView().getResolution()),D=E.getTileRangeForExtentAndZ(y.getView().calculateExtent(y.getSize()),F),C=D.maxX-D.minX+1,H=D.maxY-D.minY+1;return C*H};var c=function(L,D){if(D>180){while(D>360){D=D-360}}else{if(D<180){while(D<-360){D=D+360}}}if(D>180){D=-180-(180-D)}if(D<-180){D=180+(D+180)}var H=(L>=0)?"N":"S";var F=(D>=0)?"E":"W";var K=1;if(L<0){K=-1}var J=Math.abs(Math.round(L*1000000));var N=1;if(D<0){N=-1}var M=Math.abs(Math.round(D*1000000));var E=Math.floor(((J/1000000)-Math.floor(J/1000000))*60);var G=Math.floor(((M/1000000)-Math.floor(M/1000000))*60);if(E<10){E="0"+E}if(G<10){G="0"+G}var O=(Math.floor(((((J/1000000)-Math.floor(J/1000000))*60)-Math.floor(((J/1000000)-Math.floor(J/1000000))*60))*100000)*60/100000);var C=(Math.floor(((((M/1000000)-Math.floor(M/1000000))*60)-Math.floor(((M/1000000)-Math.floor(M/1000000))*60))*100000)*60/100000);if(O<10){O="0"+O}if(C<10){C="0"+C}if(O.toString().indexOf(".")<0){O+=".0000"}if(C.toString().indexOf(".")<0){C+=".0000"}L=((Math.floor(J/1000000)*K)+"&deg;"+E+"'"+O);D=((Math.floor(M/1000000)*N)+"&deg;"+G+"'"+C);var I=(L+"0000").split(".");if(I.length==2){I[1]=I[1].substring(0,4);L=I[0]+"."+I[1]}I=(D+"0000").split(".");if(I.length==2){I[1]=I[1].substring(0,4);D=I[0]+"."+I[1]}L+='" '+H;D+='" '+F;q.innerHTML=D;u.innerHTML=L};var g=javaxt.dhtml.utils.merge;var d=javaxt.dhtml.utils.setStyle;var j=javaxt.dhtml.utils.addResizeListener;r()};
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapOverlay=function(a){var g=this;var c;var j=function(){var m=a.el.offsetWidth;var u=a.el.offsetHeight;var r=a.getProjection();var p=a.getMap();var t=p.getView();var v=t.calculateExtent(p.getSize());var q=v[0];var o=v[1];var l=v[2];var k=v[3];var s=a.overlay;if(!s){c=new com.kartographia.MapTile(q,o,l,k,m,u,r);var n=c.getCanvas();n.style.position="absolute";n.style.top=0;n.style.width="100%";n.style.height="100%";a.el.appendChild(n);a.overlay=c}else{c=a.overlay}};this.remove=function(){var k=c.getCanvas();a.el.removeChild(k);a.overlay=null};this.clear=function(){c.clear()};this.addPoint=function(n,o,k,m,l){c.addPoint(n,o,k,m,l)};this.addLine=function(m,k,l){c.addLine(m,k,l)};this.addText=function(o,m,n,k,l){c.addText(o,m,n,k,l)};this.renderTracks=function(M,J,N){if(!M){return}var r=N.tailLength;var H=N.color;var D=N.labels?N.labels.indexOf("device")>-1:false;var n=N.labels?N.labels.indexOf("telemetry")>-1:false;var B=N.speed;if(B!=null){if(B.indexOf("-")===-1){B=[0,parseFloat(B)]}else{var l=B.split("-");B=[parseFloat(l[0]),parseFloat(l[1])]}}for(var K=0;K<M.length;K++){var E=M[K];var m=f(E,J);if(m!=null){var v=m[1];var p=m[0];var q=m[3];var L=m[4];var s=L!=null?(L*2.236936):0;if(B){if(s>=B[0]&&s<=B[1]){}else{continue}}var w=null;if(D==true){w=E.id+""}if(n==true){if(s>0){s=i(s);if(s==0){s=0.1}s+=" mph";if(w==null){w=s}else{w+="\n"+s}if(q!=null){w+=", bearing "+i(q)}}}c.addPoint(v,p,H,5,w);if(q!=null||L!=null){var C=[[v,p]];var u=v;var o=p;var z=J-(r*60*1000);var P=[];for(var I=0;I<E.coords.length;I++){var O=E.coords[I];if(O[2]>=z&&O[2]<J){P.push(O)}}var A=J;for(var A=J;A>=z;A=A-(60*1000)){var y=P.length;for(var G=P.length-1;G>=0;G--){var F=P[G];if(F[2]>A){v=F[1];p=F[0];if(v!=u&&p!=o){C.push([v,p])}y--}}P.length=y;var O=f(E,A);if(O){v=O[1];p=O[0];if(v!=u&&p!=o){C.push([v,p])}u=v;o=p}}if(C.length>1){c.addLine(C,H,1)}}}}};var f=function(w,B){var r=w.coords;var k=null;var D=null;var A=null;for(var z=0;z<r.length;z++){var y=r[z];var s=y[2];if(s>B){D=y;if(z>0){A=r[z-1];var p=A[2];if(p==s){k=A;if(z>1){A=r[z-2]}else{A=null}}}break}}if(A!=null){var x=b(A[0],A[1]);var q=A[2];var m;var C;if(A.length<4){var v;var p;if(k!=null){v=b(k[0],k[1]);p=k[2]}else{v=b(D[0],D[1]);p=D[2]}var l=e(x,v);var n=(p-q)/1000;C=l/n;m=h(x,v);A.push(m);A.push(C)}else{m=A[3];C=A[4]}var o=(B-q)/1000;var u=C*o;try{k=d(x,u,m);k.push(B);k.push(m);k.push(C)}catch(E){}}return k};var b=function(k,l){return window.getLatLon(l,k)};var e=function(l,k){return l.distanceTo(k)};var h=function(m,l){var k=m.initialBearingTo(l);return isNaN(k)?0:k};var d=function(m,n,k){var l=m.destinationPoint(n,k);return[l.longitude,l.latitude]};var i=function(k){return Math.round(k*10)/10};j()};
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapTile=function(q,o,p,n,j,i,r){var e=0;var d=0;var b=1;var a=1;var c,k;var l=function(){c=document.createElement("canvas");c.width=j;c.height=i;k=c.getContext("2d");if(r=="EPSG:3857"){e=q;d=n;b=j/h(p,q);a=i/h(o,n)}else{if(r=="EPSG:4326"){q=g(q);o=f(o);p=g(p);n=f(n);e=q;d=n;b=j/(p-q);a=i/(o-n)}}};this.getCanvas=function(){return c};this.getImage=function(){return k.getImageData(0,0,c.width,c.height)};this.clear=function(){k.clearRect(0,0,c.width,c.height)};this.addPoint=function(x,t,v,B,z){var u=g(t);var y=f(x);var s=B/2;k.beginPath();k.arc(u,y,s,0,2*Math.PI,false);k.fillStyle=v;k.fill();if(z!=null){var w=z.split("\n");var A=15;k.font=A+"px Arial";k.fillText(w[0],u+s,y);if(w.length>1){k.font="8px Arial";k.fillText(w[1],u+s,(y+A))}}};this.addLine=function(z,u,A){k.strokeStyle=u;k.beginPath();for(var v=0;v<z.length;v++){var w=z[v];var x=w[0];var s=w[1];var t=g(s);var y=f(x);if(v==0){k.moveTo(t,y)}else{k.lineTo(t,y)}}k.stroke()};this.addText=function(y,w,x,s,u){var t=g(x);var v=f(w);k.fillStyle=s;k.font=u+"px Arial";k.fillText(y,t,v)};var g=function(t){if(r=="EPSG:3857"){var s=t*20037508.34/180;var u=h(s,e);if(s<e){u=-u}return u*b}else{if(r=="EPSG:4326"){t+=180;var s=(t-e)*b;return s}}};var f=function(s){if(r=="EPSG:3857"){var u=Math.log(Math.tan((90+s)*Math.PI/360))/(Math.PI/180);u=u*20037508.34/180;var t=h(u,d);if(u>d){t=-t}return t*a}else{if(r=="EPSG:4326"){s=-s;if(s<=0){s=90+-s}else{s=90-s}s=180-s;var u=(s-d)*a;if(m(u)==0||m(u)==-0){u=0}return u}}};var m=function(s){return Math.round(s)};var h=function(t,s){return Math.abs(t-s)};l()};